<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add Product Modal</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/sample.css">

</head>
<body class="p-4">

<!-- Trigger button -->
<button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addProductModal">
  + Add Product
</button>

<!-- Modal -->
<div class="modal fade" id="addProductModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form id="productForm">
        <div class="modal-header">
          <h5 class="modal-title">Add Product</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <!-- Product Name -->
<div class="mb-3">
  <label class="form-label">Product Name</label>
  <input type="text" class="form-control" name="name" required>
</div>

<!-- Product Description -->
<div class="mb-3">
  <label class="form-label">Description</label>
  <textarea class="form-control" name="description" rows="3" placeholder="Enter product description..."></textarea>
</div>

<!-- Product Category -->
<div class="mb-3">
  <label class="form-label">Category</label>
  <select class="form-select" name="category" required>
    <option value="" selected disabled>-- Select Category --</option>
    <option value="dairy">Dairy</option>
    <option value="beverage">Beverage</option>
    <option value="snack">Snack</option>
    <option value="other">Other</option>
  </select>
</div>


          <!-- Price (if no variants) -->
          <div class="mb-3" id="mainPriceField">
            <label class="form-label">Price</label>
            <input type="number" class="form-control" name="price" step="0.01" min="0">
          </div>

          <!-- Has Variants -->
          <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" id="hasVariants" onchange="toggleVariants()">
            <label class="form-check-label" for="hasVariants">This product has variants (sizes/colors)</label>
          </div>

          <!-- Quantity -->
          <div class="mb-3" id="mainQuantityField">
            <label class="form-label">Quantity</label>
            <input type="number" class="form-control" name="quantity" min="0">
          </div>

          <!-- Auto Stock + Price Range -->
          <div class="mb-3 d-none" id="totalStockField">
            <label class="form-label">Total Stock</label>
            <input type="number" class="form-control" id="totalStock" readonly>
          </div>
          <div class="mb-3 d-none" id="priceRangeField">
            <label class="form-label">Price Range</label>
            <input type="text" class="form-control" id="priceRange" readonly>
          </div>

          <!-- Primary Image -->
          <div class="mb-3">
            <label class="form-label">Primary Image</label>
            <input type="file" class="form-control" accept="image/*" onchange="previewPrimary(event)">
            <div id="primaryPreview" class="mt-2"></div>
          </div>

          <!-- Gallery -->
          <div class="mb-3">
            <label class="form-label">Gallery Images</label>
            <input type="file" class="form-control" accept="image/*" multiple onchange="previewGallery(event)">
            <div id="galleryPreview" class="gallery-preview"></div>
          </div>

          <!-- Variants -->
          <div class="mb-3 d-none" id="variantSection">
            <label class="form-label">Variants</label>
            <table class="table table-sm table-bordered align-middle" id="variantTable">
              <thead class="table-light">
                <tr>
                  <th>Variant</th>
                  <th>Price</th>
                  <th>Stock</th>
                  <th>Image</th>
                  <th>Preview</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
            <button type="button" class="btn btn-secondary btn-sm" onclick="addVariant()">+ Add Variant</button>
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Save Product</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
let variantCounter = 0;

function toggleVariants() {
  const hasVariants = document.getElementById('hasVariants').checked;
  document.getElementById('mainPriceField').classList.toggle('d-none', hasVariants);
  document.getElementById('mainQuantityField').classList.toggle('d-none', hasVariants);
  document.getElementById('variantSection').classList.toggle('d-none', !hasVariants);
  document.getElementById('totalStockField').classList.toggle('d-none', !hasVariants);
  document.getElementById('priceRangeField').classList.toggle('d-none', !hasVariants);
  if (!hasVariants) {
    document.getElementById('totalStock').value = "";
    document.getElementById('priceRange').value = "";
  }
}

function previewPrimary(event) {
  const preview = document.getElementById('primaryPreview');
  preview.innerHTML = '';
  const file = event.target.files[0];
  if (file) {
    const img = document.createElement('img');
    img.src = URL.createObjectURL(file);
    img.classList.add('image-preview');
    preview.appendChild(img);
  }
}

function previewGallery(event) {
  const gallery = document.getElementById('galleryPreview');
  gallery.innerHTML = '';
  const files = event.target.files;
  Array.from(files).forEach(file => {
    const div = document.createElement('div');
    div.classList.add('gallery-item');
    const img = document.createElement('img');
    img.src = URL.createObjectURL(file);
    img.classList.add('image-preview');
    const btn = document.createElement('button');
    btn.innerHTML = "×";
    btn.onclick = () => div.remove();
    div.appendChild(img);
    div.appendChild(btn);
    gallery.appendChild(div);
  });
}

function addVariant() {
  const tbody = document.querySelector('#variantTable tbody');
  const row = document.createElement('tr');
  const id = `variantImg${variantCounter++}`;
  row.innerHTML = `
    <td><input type="text" name="variantName[]" class="form-control" required></td>
    <td><input type="number" name="variantPrice[]" class="form-control variantPrice" step="0.01" min="0" value="0" oninput="updatePriceRange()" required></td>
    <td><input type="number" name="variantStock[]" class="form-control variantStock" min="0" value="0" oninput="updateTotalStock()" required></td>
    <td><input type="file" name="variantImage[]" id="${id}" accept="image/*" class="form-control" onchange="previewVariant(event, '${id}')"></td>
    <td><img id="${id}Preview" class="variant-preview"></td>
    <td><button type="button" class="btn btn-danger btn-sm" onclick="removeVariant(this)">Delete</button></td>
  `;
  tbody.appendChild(row);
  updateTotalStock();
  updatePriceRange();
}

function previewVariant(event, id) {
  const file = event.target.files[0];
  const preview = document.getElementById(id + "Preview");
  preview.src = file ? URL.createObjectURL(file) : "";
}

function removeVariant(btn) {
  btn.closest('tr').remove();
  updateTotalStock();
  updatePriceRange();
}

function updateTotalStock() {
  const stocks = document.querySelectorAll('.variantStock');
  let total = 0;
  stocks.forEach(input => total += parseInt(input.value || 0, 10));
  document.getElementById('totalStock').value = total;
}

function updatePriceRange() {
  const prices = document.querySelectorAll('.variantPrice');
  let values = [];
  prices.forEach(input => {
    let val = parseFloat(input.value || 0);
    if (!isNaN(val)) values.push(val);
  });
  if (values.length === 0) {
    document.getElementById('priceRange').value = "";
    return;
  }
  const min = Math.min(...values);
  const max = Math.max(...values);
  document.getElementById('priceRange').value = (min === max) ? 
    `₱${min.toFixed(2)}` : `₱${min.toFixed(2)} – ₱${max.toFixed(2)}`;
}

document.getElementById("productForm").addEventListener("submit", function(e) {
  e.preventDefault();
  alert("Product saved! (connect this to backend)");
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
